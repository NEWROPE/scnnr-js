!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).scnnr=t()}(this,function(){"use strict";function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function a(e,t,n){return(a=o()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&s(o,n.prototype),o}).apply(null,arguments)}function t(e){var n="function"==typeof Map?new Map:void 0;return(t=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,u(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),s(t,e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(i){var s=o();return function(){var e,t,n,r,o=u(i);return t=s?(e=u(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(r=t)||"object"!=typeof r&&"function"!=typeof r?l(n):r}}function c(n,r){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return n.apply(r,e)}}var n={url:"https://api.scnnr.cubki.jp/",version:"v1",timeout:null,apiKey:null},h=Object.prototype.toString;function d(e){return"[object Array]"===h.call(e)}function m(e){return null!==e&&"object"==typeof e}function y(e){return"[object Function]"===h.call(e)}function v(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),d(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function g(e,t,n,r,o){var i,s,u,a,c=new Error(e);return s=n,u=r,a=o,(i=c).config=t,s&&(i.code=s),i.request=u,i.response=a,i}var w={isArray:d,isArrayBuffer:function(e){return"[object ArrayBuffer]"===h.call(e)},isBuffer:function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){var t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer;return t},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:m,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===h.call(e)},isFile:function(e){return"[object File]"===h.call(e)},isBlob:function(e){return"[object Blob]"===h.call(e)},isFunction:y,isStream:function(e){return m(e)&&y(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:v,merge:function n(){var r={};function e(e,t){r[t]="object"==typeof r[t]&&"object"==typeof e?n(r[t],e):e}for(var t=0,o=arguments.length;t<o;t++)v(arguments[t],e);return r},extend:function(n,e,r){return v(e,function(e,t){n[t]=r&&"function"==typeof e?c(e,r):e}),n},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}};function b(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var k,R,T,P=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],E=w.isStandardBrowserEnv()?(R=/(msie|trident)/i.test(navigator.userAgent),T=document.createElement("a"),k=j(window.location.href),function(e){var t=w.isString(e)?j(e):e;return t.protocol===k.protocol&&t.host===k.host}):function(){return!0};function j(e){var t=e;return R&&(T.setAttribute("href",t),t=T.href),T.setAttribute("href",t),{href:T.href,protocol:T.protocol?T.protocol.replace(/:$/,""):"",host:T.host,search:T.search?T.search.replace(/^\?/,""):"",hash:T.hash?T.hash.replace(/^#/,""):"",hostname:T.hostname,port:T.port,pathname:"/"===T.pathname.charAt(0)?T.pathname:"/"+T.pathname}}function x(h){return new Promise(function(f,l){var n=h.data,r=h.headers;w.isFormData(n)&&delete r["Content-Type"];var e,t,p=new XMLHttpRequest;if(h.auth&&(r.Authorization="Basic "+btoa((h.auth.username||"")+":"+(h.auth.password||""))),p.open(h.method.toUpperCase(),function(e,t,n){if(!t)return e;var r,o=n?n(t):w.isURLSearchParams(t)?t.toString():(r=[],w.forEach(t,function(e,t){null!=e&&(w.isArray(e)?t+="[]":e=[e],w.forEach(e,function(e){w.isDate(e)?e=e.toISOString():w.isObject(e)&&(e=JSON.stringify(e)),r.push(b(t)+"="+b(e))}))}),r.join("&"));return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e}(h.url,h.params,h.paramsSerializer),!0),p.timeout=h.timeout,p.onreadystatechange=function(){var e,t,n,r,o,i,s,u,a,c;p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&(e="getAllResponseHeaders"in p?(t=p.getAllResponseHeaders(),i={},t&&w.forEach(t.split("\n"),function(e){if(o=e.indexOf(":"),n=w.trim(e.substr(0,o)).toLowerCase(),r=w.trim(e.substr(o+1)),n){if(i[n]&&0<=P.indexOf(n))return;i[n]="set-cookie"===n?(i[n]?i[n]:[]).concat([r]):i[n]?i[n]+", "+r:r}}),i):null,s=f,u=l,c=(a={data:h.responseType&&"text"!==h.responseType?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:e,config:h,request:p}).config.validateStatus,a.status&&c&&!c(a.status)?u(g("Request failed with status code "+a.status,a.config,null,a.request,a)):s(a),p=null)},p.onerror=function(){l(g("Network Error",h,null,p)),p=null},p.ontimeout=function(){l(g("timeout of "+h.timeout+"ms exceeded",h,"ECONNABORTED",p)),p=null},w.isStandardBrowserEnv()&&(e=C,(t=(h.withCredentials||E(h.url))&&h.xsrfCookieName?e.read(h.xsrfCookieName):void 0)&&(r[h.xsrfHeaderName]=t)),"setRequestHeader"in p&&w.forEach(r,function(e,t){void 0===n&&"content-type"===t.toLowerCase()?delete r[t]:p.setRequestHeader(t,e)}),h.withCredentials&&(p.withCredentials=!0),h.responseType)try{p.responseType=h.responseType}catch(e){if("json"!==h.responseType)throw e}"function"==typeof h.onDownloadProgress&&p.addEventListener("progress",h.onDownloadProgress),"function"==typeof h.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",h.onUploadProgress),h.cancelToken&&h.cancelToken.promise.then(function(e){p&&(p.abort(),l(e),p=null)}),void 0===n&&(n=null),p.send(n)})}var C=w.isStandardBrowserEnv()?{write:function(e,t,n,r,o,i){var s=[];s.push(e+"="+encodeURIComponent(t)),w.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),w.isString(r)&&s.push("path="+r),w.isString(o)&&s.push("domain="+o),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},O={"Content-Type":"application/x-www-form-urlencoded"};function S(e,t){!w.isUndefined(e)&&w.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var A,q={adapter:("undefined"==typeof XMLHttpRequest&&"undefined"==typeof process||(A=x),A),transformRequest:[function(e,t){var n,r;return r="Content-Type",w.forEach(n=t,function(e,t){t!==r&&t.toUpperCase()===r.toUpperCase()&&(n[r]=e,delete n[t])}),w.isFormData(e)||w.isArrayBuffer(e)||w.isBuffer(e)||w.isStream(e)||w.isFile(e)||w.isBlob(e)?e:w.isArrayBufferView(e)?e.buffer:w.isURLSearchParams(e)?(S(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):w.isObject(e)?(S(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};w.forEach(["delete","get","head"],function(e){q.headers[e]={}}),w.forEach(["post","put","patch"],function(e){q.headers[e]=w.merge(O)});var B=q;function U(){this.handlers=[]}U.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},U.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},U.prototype.forEach=function(t){w.forEach(this.handlers,function(e){null!==e&&t(e)})};function _(t,n,e){return w.forEach(e,function(e){t=e(t,n)}),t}function I(e){return!(!e||!e.__CANCEL__)}var D=U;function F(e){e.cancelToken&&e.cancelToken.throwIfRequested()}function L(t){var e,n;return F(t),t.baseURL&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t.url)&&(t.url=(e=t.baseURL,(n=t.url)?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e)),t.headers=t.headers||{},t.data=_(t.data,t.headers,t.transformRequest),t.headers=w.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),w.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||B.adapter)(t).then(function(e){return F(t),e.data=_(e.data,e.headers,t.transformResponse),e},function(e){return I(e)||(F(t),e&&e.response&&(e.response.data=_(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}function N(e){this.defaults=e,this.interceptors={request:new D,response:new D}}N.prototype.request=function(e,t){"string"==typeof e&&(e=w.merge({url:arguments[0]},t)),(e=w.merge(B,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var n=[L,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){n.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){n.push(e.fulfilled,e.rejected)});n.length;)r=r.then(n.shift(),n.shift());return r},w.forEach(["delete","get","head","options"],function(n){N.prototype[n]=function(e,t){return this.request(w.merge(t||{},{method:n,url:e}))}}),w.forEach(["post","put","patch"],function(r){N.prototype[r]=function(e,t,n){return this.request(w.merge(n||{},{method:r,url:e,data:t}))}});var z=N;function K(e){this.message=e}K.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},K.prototype.__CANCEL__=!0;var H=K;function J(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new H(e),t(n.reason))})}J.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},J.source=function(){var t;return{token:new J(function(e){t=e}),cancel:t}};var V=J;function M(e){var t=new z(e),n=c(z.prototype.request,t);return w.extend(n,z.prototype,t),w.extend(n,t),n}var X=M(B);X.Axios=z,X.create=function(e){return M(w.merge(B,e))},X.Cancel=H,X.CancelToken=V,X.isCancel=I,X.all=function(e){return Promise.all(e)},X.spread=function(t){return function(e){return t.apply(null,e)}};var $=X;$.default=X;var G=$,Q=function(){e(r,t(Error));var n=p(r);function r(e){var t;return f(this,r),t=n.call(this,e),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(l(t),r):t.stack=(new Error).stack,t}return r}(),W=function(){e(r,Q);var n=p(r);function r(e){var t;return f(this,r),(t=n.call(this,e)).name="PollTimeout",t}return r}(),Y=function(){e(r,Q);var n=p(r);function r(e){var t;return f(this,r),(t=n.call(this,e)).name="PreconditionFailed",t}return r}();function Z(e,t,n){var r="";return e&&(r="[".concat(e,"]")),t&&(r="".concat(r," ").concat(t)),n&&(r="".concat(r," (").concat(n,")")),r}var ee=function(){e(c,Q);var a=p(c);function c(e){var t=e.title,n=e.detail,r=e.type,o=e.statusCode,i=e.rawResponse;f(this,c);var s,u=Z(t,n,r);return(s=a.call(this,u)).name="ScnnrAPIError",Object.assign(l(s),{title:t,detail:n,type:r,statusCode:o,rawResponse:i}),s}return c}(),te=function(){e(a,Q);var u=p(a);function a(e,t){var n=e.title,r=e.detail,o=e.type;f(this,a);var i,s=Z(n,r,o);return(i=u.call(this,s)).name="RecognitionError",Object.assign(l(i),{title:n,detail:r,type:o,recognition:t}),i}return a}(),ne=Object.freeze({__proto__:null,ScnnrError:Q,PollTimeout:W,PreconditionFailed:Y,ScnnrAPIError:ee,RecognitionError:te}),re=function(){function e(){f(this,e),this.interceptRequest=this.interceptRequest.bind(this)}return i(e,[{key:"interceptRequest",value:function(e){return Promise.resolve(e)}}]),e}(),oe=function(){e(r,re);var n=p(r);function r(e){var t;return f(this,r),(t=n.call(this)).apiKey=e,t}return i(r,[{key:"interceptRequest",value:function(t){var n=this;return new Promise(function(e){t.headers["x-api-key"]=n.apiKey,e(t)})}}]),r}(),ie=function(){function n(e,t){f(this,n),this.value=e,this.expiresIn=t,this.expiresAt=new Date(Date.now()+1e3*t)}return i(n,[{key:"hasExpired",value:function(e){var t=0<arguments.length&&void 0!==e?e:0;return Date.now()>=this.expiresAt.getTime()-t}}]),n}();function se(e){switch(e.type){case"one-time":return new ie(e.value,e.expires_in);default:return null}}var ue=Object.freeze({__proto__:null,OneTimeToken:ie,buildToken:se}),ae=function(){function n(e,t){f(this,n),this.publicAPIKey=e,this.options=t,this.token=null,this.timeout=null,this.marginToExpire=.05}return i(n,[{key:"get",value:function(){var e=this;return this.issue().then(function(){return e.getAndClearToken()})}},{key:"issue",value:function(){var t=this;return this.hasValidToken()?Promise.resolve():this.requestToken().then(function(e){t.token=e})}},{key:"requestToken",value:function(){return he.build(!0,Object.assign({},this.options,{apiKey:this.publicAPIKey})).sendJson("/auth/tokens",{type:"one-time"}).then(function(e){return se(e.data)})}},{key:"hasValidToken",value:function(){return null!=this.token&&!this.token.hasExpired(this.token.expiresIn*this.marginToExpire*1e3)}},{key:"getAndClearToken",value:function(){var e=this.token;return this.token=null,e}}]),n}(),ce=function(){e(o,re);var r=p(o);function o(e,t){var n;return f(this,o),(n=r.call(this)).oneTimeTokenProvider=new ae(e,t),n}return i(o,[{key:"interceptRequest",value:function(t){return this.oneTimeTokenProvider.get().then(function(e){return t.headers["x-api-key"]="use-scnnr-one-time-token",t.headers["x-scnnr-one-time-token"]=e.value,t})}}]),o}();function fe(e){return"string"!=typeof e||""===(e=e.replace(/^\s*/,"").replace(/\s*$/,""))?null:e}function le(e){var t=fe(e.apiKey),n=fe(e.publicAPIKey);if(null!=t)return new oe(t);if(null!=n)return new ce(n,{url:e.url,version:e.version});throw new Y("`apiKey` or `publicAPIKey` configuration is required.")}function pe(e){var t=e.width,n=e.height;f(this,pe),this.width=t,this.height=n}var he=function(){function a(e){var t=e.url,n=e.apiKey,r=e.params,o=e.authInterceptor,i=e.onUploadProgress,s=e.onDownloadProgress;f(this,a);var u={};n&&(u["x-api-key"]=n),this.httpClient=G.create({params:r,headers:u,baseURL:t,onUploadProgress:i,onDownloadProgress:s}),this.httpClient.interceptors.response.use(function(e){return e},this.errorInterceptor),null!=o&&this.httpClient.interceptors.request.use(o.interceptRequest)}return i(a,[{key:"get",value:function(e){return this.httpClient.get(e,null)}},{key:"sendJson",value:function(e,t){return this.send(e,t,"application/json")}},{key:"sendBinary",value:function(e,t){return this.send(e,t,"application/octet-stream")}},{key:"send",value:function(e,t,n){return this.httpClient.post(e,t,{headers:{"Content-Type":n}})}},{key:"errorInterceptor",value:function(e){return e.response?Promise.reject(new ee({title:e.response.data.title||e.response.data.message,detail:e.response.data.detail||e.message,type:e.response.data.type,rawResponse:e.response.data,statusCode:e.response.status})):Promise.reject(e)}}],[{key:"build",value:function(e,t){var n=t.params||{};return 0<(t.timeout||0)&&(n.timeout=t.timeout),new a({params:n,authInterceptor:e?le(t):null,url:t.url+t.version,onUploadProgress:t.onUploadProgress,onDownloadProgress:t.onDownloadProgress})}}]),a}(),de=function e(t){f(this,e),this.category=t.category,this.boundingBox=t.boundingBox||t.bounding_box,this.labels=t.labels},me=function e(t){var n=t.url,r=t.size;f(this,e),this.url=n,this.size=new pe(r)};me.Size=pe;var ye=function(){function s(e){var t=e.id,n=e.objects,r=e.state,o=e.image,i=e.error;f(this,s),this.id=t,this.objects=(n||[]).map(function(e){return new de(e)}),this.state=r,null!=o&&(this.image=new me(o)),this.error=i}return i(s,[{key:"isFinished",value:function(){return"finished"===this.state}},{key:"hasError",value:function(){return!!this.error}}]),s}();function ve(e){var n=this,r=e.requestFunc,o=e.conditionChecker,i=e.remainingTime,s=(i||0)-25<0?i:25;return new Promise(function(t,e){return i<=0?e(new W("Polling timed out")):r({timeout:s}).then(function(e){return o(e)?t(e):t(ve.call(n,{requestFunc:r,conditionChecker:o,remainingTime:i-s}))})})}ye.Item=de,ye.Image=me;var ge=function(){function t(e){f(this,t),this.config=Object.assign({},n,e)}return i(t,[{key:"recognizeURL",value:function(t,e){var n=this;return this.recognizeRequest(function(e){return n.connection(!0,e).sendJson("/remote/recognitions",{url:t})},1<arguments.length&&void 0!==e?e:{})}},{key:"recognizeImage",value:function(t,e){var n=this,r=1<arguments.length&&void 0!==e?e:{},o=Object.assign({},r,{params:{public:r.public}});return this.recognizeRequest(function(e){return n.connection(!0,e).sendBinary("/recognitions",t)},o)}},{key:"recognizeRequest",value:function(e,n){var r=this,o=function(e,t){var n=0<arguments.length&&void 0!==e?e:0,r=1<arguments.length?t:void 0;return n-r<0?n:r}(n.timeout,25),i=e(Object.assign({},n,{timeout:o}));return new Promise(function(e,t){i.then(r.handleResponse).then(function(t){return 0<(n.timeout||0)&&!t.isFinished()?ve({requestFunc:function(e){return r.fetch(t.id,e)},conditionChecker:function(e){return e.isFinished()},remainingTime:n.timeout-o}):e(t)}).then(e).catch(t)})}},{key:"fetch",value:function(e,t){return this.connection(!1,1<arguments.length&&void 0!==t?t:{}).get("/recognitions/".concat(e)).then(this.handleResponse)}},{key:"handleResponse",value:function(e){var t=new ye(e.data);if(t.hasError())throw new te(t.error,t);return t}},{key:"connection",value:function(e,t){return he.build(e,Object.assign({},this.config,t))}}]),t}();return Object.assign(function(e){return new ge(e)},{Client:ge,Connection:he,Recognition:ye,PrivateKeyAuthInterceptor:oe,PublicKeyAuthInterceptor:ce,authInterceptor:le,OneTimeTokenProvider:ae},ue,ne)});
